/* Growbox Arduino!
 Program been included drivers to:
  *  SSD1306 Oled display
  *  DHT22 temperature and humidity sensor
  *  3x Dallas DS18B20 sensor
  *  2x fun(to regulate and stabilisation temperature and humidity)
  *  Soil Humidity Sensor  
  *  RTC modulde
  *  In future I will add wifi module
 */
  
#include <Adafruit_SSD1306.h>
#include <Adafruit_GFX.h>
#include <DallasTemperature.h>
#include <OneWire.h>
#include <DS3231.h>
#include <Wire.h>
#include <SimpleDHT.h>


  #define ahumid_min 55
  #define ahumid_max 70
 
  #define ghumid_min 50
  #define ghumid_max 80
 
  #define atemp_min 21
  #define atemp_max 25
 
  #define gtemp_min 18
  #define gtemp_max 20
 
Adafruit_SSD1306 Display(2);

OneWire oneWire(3);
DallasTemperature sensors(&oneWire);

DS3231 RTC;

#define DHTPIN 4    // what pin we're connected to
#define DHTTYPE DHT22 
int att 5
int State = LOW;
int temp_1 = 0;
int temp_2 = 0;
int temp_3 = 0;
int ghum1 = 0;
int chk;
int gleb;
float hum;  //Stores humidity value
float temp; //Tepmerature value
bool Century = false;
unsigned long previousMillis1 = 0;
long OnTime1 = 250;
long OffTime1 = 750; 
 
void Watchdog() { 
if(State==HIGH) {
State=LOW;
DigitalWrite(att, State);
}
else if (State==LOW) {
State=HIGH
digitalWtrte(att, State);
}



void PrintData() {
Display.setTextSize(1);
Display.setTextColor(WHITE);
Display.SetCursor(100, 21); Display.print(temp);
Display.SetCursor(100, 31); Display.print(hum);
Display.SetCursor(100, 41); Display.print(temp_1);
Display.SetCursor(100, 51); Display.print(gleb);
Display.display();

}



void DrawMenu() {

  Display.setTextSize(2);
  Display.setTextColor(WHITE);
  Display.setCursor(0, 1);
  Display.println("GrowBox");
  Display.drawRect(0, 0, 128, 20, WHITE);
   Display.setTextSize(1);
    Display.setCursor(0, 11);
  Display.print("Data:");
  Display.print(RTC.getDate(), DEC); 
  Display.print(RTC.getMonth(Century), DEC);
  Display.print(RTC.getYear(), DEC); 
    Display.setCursor(90, 11);
  Display.print("Czas:");
 // Display.print(RTC.getHour(), DEC);
  Display.print(RTC.getMinute(), DEC); 
  Display.print(RTC.getSecond(), DEC);
    Display.setCursor(0, 21);
  Display.print("Temperatura Powietrza"); 
    Display.setCursor(0, 31);
  Display.print("Wilgotnosc Powietrza");
    Display.setCursor(0, 41);
  Display.print("Temperatura Gleby");
    Display.setCursor(0, 51);
  Display.print("Wilgotnosc Gleby");
  Display.display();
}
void check() {
  for(temp_1 < atemp_min){
    
  }
  for(temp_1 > atemp_max){
    
  }
  for(gleb < ghumid_min){
     
  }
  for(gleb > ghumid_max) {
    
  }
  
  
}

void reading () {

       sensors.requestTemperatures();
       temp_1 = sensors.getTempCByIndex(0);
       temp_2 = sensors.getTempCByIndex(1);
       temp_3 = sensors.getTempCByIndex(2);
       hum = dht.readHumidity();
       temp= dht.readTemperature();
  
}

void setup() {
    Display.begin(SSD1306_SWITCHCAPVCC, 0x3C);
      dht.begin();
      pinMode(att, OUTPUT);
    
  }

void loop() {
 if (Century) {      // Won't need this for 89 years.
    Serial.print("1");
  } else {
    Serial.print("0");
  }
unsigned long currentMillis = millis();
if(currentMillis - previousMillis >= OnTime) {
DrawMenu();
PrintData();
} else if (currentMillis - previousMillis >= OffTime) {
  reading();
  check();
  WatchDog();
}
}








/*
Jin rong electronics co., LTD
-stm32f103 x5/ x10
-CSR8645 APT-X Bluetooth 4.0 Pokładzie Wzmacniacz 5 W + 5 x2
-Nowy XS3868 Moduł OVC3860 x2
-PAM8610 2x15 W wzmacniacz deska cyfrowy dwukanałowy.
*/

